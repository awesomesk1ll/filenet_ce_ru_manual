# Пакетные операции

В CE есть классы UpdatingBatch и RetrievingBatch. Они служат для пакетного изменения или получения объектов. Эти классы имеют общего родителя Batch.

"Пакетный" означает, что действия над группой объектов выполняются единовременно, в одной точке кода (подразумевается код верхнего уровня).

С помощью пакетных операций можно значительно улучшить производительность. Пакетные операции рекомендуется применять, если бизнес-логика допускает разбиение на *независимые* операции над объектами, т.е. внутри "пакета" каждая операция над объектом никак не зависит от состояний других объектов и результатов прочих операций.

* Пакетное изменение транзакционно. Это значит, что либо все операции будут успешными, либо никаких изменений не будет сделано вообще
* Пакетное получение не транзакционно. Это значит, у каждого объекта может быть свой результат: успешное обновление свойств либо какое-то исключение

## Пакетное изменение

Рассмотрим методы UpdatingBatch:

метод | что делает
------------ | -------------
`BatchItemHandle add(IndependentlyPersistableObject object, PropertyFilter filter)`|Добавляет объект в пакет. Параметр filter определяет, какие свойства нужно извлечь
`static UpdatingBatch createUpdatingBatchInstance(Domain domain, RefreshMode refresh)`|Фабричный метод пакета изменений. Параметр refresh может принимать значения RefreshMode.REFRESH и RefreshMode.NO_REFRESH. Он определяет, будут ли свойства в локальном кэше переписаны актуальными после завершения операции
`boolean hasPendingExecute()`|Возвращает, есть ли в пакете элементы, ожидающие изменения
`void updateBatch()`|Запустить пакетную операцию

Порядок действий:

1. Создать или получить объекты, которые нужно обновить
2. Изменить эти объекты, не вызывая метод save()
3. Создать объект updatingBatch  - UpdatingBatch.createUpdatingBatchInstance()
4. Добавить изменённые объекты в пакет - add()
5. Запустить пакетное обновление - updateBatch()

## Пакетное получение
